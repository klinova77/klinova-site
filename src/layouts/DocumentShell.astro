<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />

  <!-- Préconnect pour GTM/GA -->
  <link rel="preconnect" href="https://www.googletagmanager.com" crossorigin>
  <link rel="preconnect" href="https://www.google-analytics.com" crossorigin>
  <link rel="dns-prefetch" href="https://www.google.com">

  <SeoBase {...seoProps} />
  <link rel="icon" type="image/svg+xml" href="/favicon.svg" />

  <!-- ✅ Preload police DANS le head -->
  <link
    rel="preload"
    href="/fonts/CaviarDreams-Bold.woff2"
    as="font"
    type="font/woff2"
    crossorigin
    media="(min-width:768px)"
  />

  <!-- ⚙️ GTM différé + sûr (onglets background) -->
  <script is:inline>
    (function() {
      window.dataLayer = window.dataLayer || [];
      function loadGTM() {
        if (window.__gtmLoaded) return; window.__gtmLoaded = true;
        (function(w,d,s,l,i){
          w[l]=w[l]||[]; w[l].push({'gtm.start': new Date().getTime(), event:'gtm.js'});
          var f=d.getElementsByTagName(s)[0], j=d.createElement(s), dl=l!='dataLayer'?'&l='+l:'';
          j.async=true; j.src='https://www.googletagmanager.com/gtm.js?id='+i+dl;
          f.parentNode.insertBefore(j,f);
        })(window,document,'script','dataLayer','GTM-TWMFLQ5X');
      }
      // Charge après onload (+ délai court) ou dès que l’onglet devient visible
      window.addEventListener('load', () => setTimeout(loadGTM, 2500));
      document.addEventListener('visibilitychange', () => {
        if (document.visibilityState === 'visible') setTimeout(loadGTM, 500);
      }, { once: true });
    })();
  </script>
</head>

<body class="font-sans bg-neutral-50 text-primary-900">
  <noscript>
    <iframe src="https://www.googletagmanager.com/ns.html?id=GTM-TWMFLQ5X"
            height="0" width="0" style="display:none;visibility:hidden"></iframe>
  </noscript>

  <slot />

  <!-- Script interne non bloquant -->
  <script src="/tracking-forms.js" defer></script>
</body>
